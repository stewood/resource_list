{% extends 'base.html' %}

{% block title %}{{ resource.name }} - Archived Resource{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>{{ resource.name }}</h1>
            <div>
                <a href="{% url 'directory:archive_list' %}" class="btn btn-secondary">
                    <i class="fas fa-archive"></i> Back to Archives
                </a>
                <a href="{% url 'directory:resource_list' %}" class="btn btn-primary">
                    <i class="fas fa-list"></i> View Active Resources
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Archive Status Banner -->
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-warning" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-archive fa-2x me-3"></i>
                <div>
                    <h5 class="alert-heading mb-1">This resource is archived</h5>
                    <p class="mb-1">
                        <strong>Archived by:</strong> 
                        {% if resource.archived_by %}
                            {{ resource.archived_by.get_full_name|default:resource.archived_by.username }}
                        {% else %}
                            Unknown
                        {% endif %}
                        on {{ resource.archived_at|date:"F j, Y" }} at {{ resource.archived_at|date:"g:i A" }}
                    </p>
                    {% if resource.archive_reason %}
                        <p class="mb-0"><strong>Reason:</strong> {{ resource.archive_reason }}</p>
                    {% endif %}
                </div>
                {% if user.is_staff %}
                <div class="ms-auto">
                    <button type="button" class="btn btn-success" onclick="unarchiveResource({{ resource.pk }})">
                        <i class="fas fa-undo"></i> Unarchive Resource
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Resource Information -->
<div class="row">
    <div class="col-md-8">
        <!-- Basic Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Basic Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Name:</strong> {{ resource.name }}</p>
                        <p><strong>Category:</strong> 
                            {% if resource.category %}
                                {{ resource.category.name }}
                            {% else %}
                                <span class="text-muted">No category assigned</span>
                            {% endif %}
                        </p>
                        <p><strong>Status:</strong> 
                            <span class="badge bg-secondary">{{ resource.get_status_display }}</span>
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Service Types:</strong></p>
                        {% if resource.service_types.all %}
                            <div class="mb-2">
                                {% for service_type in resource.service_types.all %}
                                    <span class="badge bg-info me-1">{{ service_type.name }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            <span class="text-muted">No service types assigned</span>
                        {% endif %}
                        
                        {% if resource.is_emergency_service %}
                            <span class="badge bg-danger me-1">Emergency Service</span>
                        {% endif %}
                        {% if resource.is_24_hour_service %}
                            <span class="badge bg-info me-1">24/7 Service</span>
                        {% endif %}
                    </div>
                </div>
                
                {% if resource.description %}
                    <hr>
                    <p><strong>Description:</strong></p>
                    <p>{{ resource.description|linebreaks }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Contact Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Contact Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {% if resource.phone %}
                            <p><strong>Phone:</strong> <a href="tel:{{ resource.phone }}">{{ resource.phone }}</a></p>
                        {% endif %}
                        {% if resource.email %}
                            <p><strong>Email:</strong> <a href="mailto:{{ resource.email }}">{{ resource.email }}</a></p>
                        {% endif %}
                        {% if resource.website %}
                            <p><strong>Website:</strong> <a href="{{ resource.website }}" target="_blank">{{ resource.website }}</a></p>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        {% if not resource.phone and not resource.email and not resource.website %}
                            <p class="text-muted">No contact information available</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Location -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Location</h5>
            </div>
            <div class="card-body">
                {% if resource.address1 or resource.city or resource.state %}
                    <p>
                        {% if resource.address1 %}{{ resource.address1 }}<br>{% endif %}
                        {% if resource.address2 %}{{ resource.address2 }}<br>{% endif %}
                        {% if resource.city and resource.state %}
                            {{ resource.city }}, {{ resource.state }}
                            {% if resource.postal_code %} {{ resource.postal_code }}{% endif %}
                        {% elif resource.city %}
                            {{ resource.city }}
                        {% elif resource.state %}
                            {{ resource.state }}
                        {% endif %}
                    </p>
                    {% if resource.county %}
                        <p><strong>County:</strong> {{ resource.county }}</p>
                    {% endif %}
                {% else %}
                    <p class="text-muted">No location information available</p>
                {% endif %}
            </div>
        </div>

        <!-- Service Details -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Service Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% if resource.hours_of_operation %}
                    <div class="col-md-6">
                        <p><strong>Hours of Operation:</strong></p>
                        <p>{{ resource.hours_of_operation|linebreaks }}</p>
                    </div>
                    {% endif %}
                    
                    {% if resource.eligibility_requirements %}
                    <div class="col-md-6">
                        <p><strong>Eligibility Requirements:</strong></p>
                        <p>{{ resource.eligibility_requirements|linebreaks }}</p>
                    </div>
                    {% endif %}
                </div>
                
                {% if resource.populations_served %}
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Populations Served:</strong></p>
                        <p>{{ resource.populations_served|linebreaks }}</p>
                    </div>
                </div>
                {% endif %}
                
                {% if resource.insurance_accepted %}
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Insurance Accepted:</strong></p>
                        <p>{{ resource.insurance_accepted|linebreaks }}</p>
                    </div>
                </div>
                {% endif %}
                
                {% if resource.cost_information %}
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Cost Information:</strong></p>
                        <p>{{ resource.cost_information|linebreaks }}</p>
                    </div>
                </div>
                {% endif %}
                
                {% if resource.languages_available %}
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Languages Available:</strong></p>
                        <p>{{ resource.languages_available }}</p>
                    </div>
                </div>
                {% endif %}
                
                {% if resource.capacity %}
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Capacity:</strong></p>
                        <p>{{ resource.capacity }}</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Verification Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Verification Information</h5>
            </div>
            <div class="card-body">
                {% if resource.last_verified_at %}
                    <p><strong>Last Verified:</strong><br>
                    {{ resource.last_verified_at|date:"F j, Y" }}<br>
                    <small class="text-muted">{{ resource.last_verified_at|date:"g:i A" }}</small>
                    </p>
                    {% if resource.last_verified_by %}
                        <p><strong>Verified By:</strong><br>
                        {{ resource.last_verified_by.get_full_name|default:resource.last_verified_by.username }}
                        </p>
                    {% endif %}
                {% else %}
                    <p class="text-muted">Not verified</p>
                {% endif %}
                
                {% if resource.source %}
                    <p><strong>Source:</strong><br>{{ resource.source }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Metadata -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Metadata</h5>
            </div>
            <div class="card-body">
                <p><strong>Created:</strong><br>
                {{ resource.created_at|date:"F j, Y" }}<br>
                <small class="text-muted">by {{ resource.created_by.get_full_name|default:resource.created_by.username }}</small>
                </p>
                
                <p><strong>Last Updated:</strong><br>
                {{ resource.updated_at|date:"F j, Y" }}<br>
                <small class="text-muted">by {{ resource.updated_by.get_full_name|default:resource.updated_by.username }}</small>
                </p>
                
                {% if resource.notes %}
                    <p><strong>Notes:</strong></p>
                    <p>{{ resource.notes|linebreaks }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Version History -->
        {% if versions %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Recent Version History</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% for version in versions %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Version {{ version.version_number }}</h6>
                            <small class="text-muted">{{ version.changed_at|date:"M j, Y" }}</small>
                        </div>
                        <p class="mb-1">{{ version.get_change_type_display }}</p>
                        <small class="text-muted">by {{ version.changed_by.get_full_name|default:version.changed_by.username }}</small>
                    </div>
                    {% endfor %}
                </div>
                <div class="mt-3">
                    <a href="{% url 'directory:version_history' resource.pk %}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-history"></i> View Full History
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}



{% block extra_js %}
<script>
function unarchiveResource(resourceId) {
    if (confirm('Are you sure you want to unarchive this resource? It will become active again and appear in the main resource list.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/directory/resources/${resourceId}/unarchive/`;
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        
        form.appendChild(csrfInput);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
